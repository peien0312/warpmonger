{% extends "public/base.html" %}

{% block title %}Warpmonger - JoyToy Warhammer & More by JohnActionFigure{% endblock %}

{% block meta_description %}Warpmonger - By John Action Figure. Shop our curated selection of premium action figures from Warhammer, Infinity, Dark Source, TMNT, and more. Quality collectibles with fast shipping and great prices.{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Warpmonger by JohnActionFigure",
  "url": "{{ request.url_root }}",
  "logo": "{{ request.url_root }}static/images/warpmonger_logo_black.png",
  "description": "Premium action figures and collectibles from Warhammer, Infinity, Dark Source, TMNT, and more.",
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "Customer Service",
    "email": "sales@johnactionfigure.com",
    "availableLanguage": ["English"]
  },
  "sameAs": [
    "https://t.me/JohnActionFigure"
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Warpmonger",
  "url": "{{ request.url_root }}",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ request.url_root }}products?search={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{% endblock %}

{% block content %}
<section class="hero">
    <div class="container">
        <h2>{{ t.welcome }}</h2>
        <p>{{ t.hero_subtitle }}</p>
        <a href="{{ url_prefix }}/products" class="btn btn-primary btn-lg">{{ t.shop_now }}</a>
    </div>
</section>

{% if active_promo %}
<section class="promo-banner-section">
    <div class="container">
        <a href="{{ url_prefix }}/promotions/{{ active_promo.slug }}" class="promo-banner-link">
            <img src="{{ active_promo.banner }}" alt="{{ active_promo.title }}">
            <div class="promo-banner-overlay">
                <h3>{{ active_promo.title }}</h3>
                <p>{{ t.view_promotion }}</p>
            </div>
        </a>
    </div>
</section>
{% endif %}

<section class="categories-section">
    <div class="container">
        <div class="faction-tags">
            {% for tag in featured_tags %}
            <a href="{{ url_prefix }}/products?tag={{ tag.name|urlencode }}" class="faction-tag">{{ tag.name }}</a>
            {% endfor %}
        </div>
    </div>
</section>

{% if new_arrivals %}
<section class="new-arrivals">
    <div class="container">
        <h2>{{ t.new_arrivals }}</h2>
        <div class="products-grid">
            {% for product in new_arrivals %}
            <div class="product-card">
                <a href="{{ url_prefix }}/products/{{ product.category }}/{{ product.slug }}">
                    <div class="product-image-container">
                        {% if product.images %}
                        <img src="/static/images/products/{{ product.category }}/{{ product.slug }}/thumb_{{ product.images[0].rsplit('.', 1)[0] }}.jpg"
                             alt="{{ product.title }} - Premium action figure - ${{ '%.2f'|format(product.price) }}"
                             loading="lazy">
                        {% else %}
                        <div class="product-placeholder">{{ t.no_image }}</div>
                        {% endif %}

                        <div class="product-badges">
                            <span class="badge badge-new">{{ t.new }}</span>
                        </div>
                    </div>

                    <h3>{{ product.zhtw_name if is_zhtw and product.zhtw_name else product.title }}</h3>

                    {% if is_zhtw %}
                        {% if product.final_price %}
                        <p class="price">NT${{ product.final_price|ntd }}</p>
                        {% endif %}
                    {% else %}
                        {% if product.is_on_sale and product.sale_price > 0 %}
                        <p class="price">
                            <span class="original-price">${{ "%.2f"|format(product.price) }}</span>
                            <span class="sale-price">${{ "%.2f"|format(product.sale_price) }}</span>
                        </p>
                        {% else %}
                        <p class="price">${{ "%.2f"|format(product.price) }}</p>
                        {% endif %}
                    {% endif %}
                </a>
            </div>
            {% endfor %}
        </div>
        <a href="{{ url_prefix }}/products?new_arrival=true" class="btn btn-secondary">{{ t.view_all_new }}</a>
    </div>
</section>
{% endif %}

{% if on_sale %}
<section class="on-sale">
    <div class="container">
        <h2>{{ t.on_sale }}</h2>
        <div class="products-grid">
            {% for product in on_sale %}
            <div class="product-card">
                <a href="{{ url_prefix }}/products/{{ product.category }}/{{ product.slug }}">
                    <div class="product-image-container">
                        {% if product.images %}
                        <img src="/static/images/products/{{ product.category }}/{{ product.slug }}/thumb_{{ product.images[0].rsplit('.', 1)[0] }}.jpg"
                             alt="{{ product.title }} - Premium action figure - ${{ '%.2f'|format(product.price) }}"
                             loading="lazy">
                        {% else %}
                        <div class="product-placeholder">{{ t.no_image }}</div>
                        {% endif %}

                        <div class="product-badges">
                            <span class="badge badge-sale">{{ t.sale }}</span>
                        </div>
                    </div>

                    <h3>{{ product.zhtw_name if is_zhtw and product.zhtw_name else product.title }}</h3>

                    {% if is_zhtw %}
                        {% if product.final_price %}
                        <p class="price">NT${{ product.final_price|ntd }}</p>
                        {% endif %}
                    {% else %}
                        {% if product.sale_price > 0 %}
                        <p class="price">
                            <span class="original-price">${{ "%.2f"|format(product.price) }}</span>
                            <span class="sale-price">${{ "%.2f"|format(product.sale_price) }}</span>
                        </p>
                        {% else %}
                        <p class="price">${{ "%.2f"|format(product.price) }}</p>
                        {% endif %}
                    {% endif %}
                </a>
            </div>
            {% endfor %}
        </div>
        <a href="{{ url_prefix }}/products?on_sale=true" class="btn btn-secondary">{{ t.view_all_sale }}</a>
    </div>
</section>
{% endif %}

<section class="featured-products">
    <div class="container">
        <h2>{{ t.featured }}</h2>
        <div class="products-grid">
            {% for product in products %}
            <div class="product-card">
                <a href="{{ url_prefix }}/products/{{ product.category }}/{{ product.slug }}">
                    <div class="product-image-container">
                        {% if product.images %}
                        <img src="/static/images/products/{{ product.category }}/{{ product.slug }}/thumb_{{ product.images[0].rsplit('.', 1)[0] }}.jpg"
                             alt="{{ product.title }} - Premium action figure - ${{ '%.2f'|format(product.price) }}"
                             loading="lazy">
                        {% else %}
                        <div class="product-placeholder">{{ t.no_image }}</div>
                        {% endif %}

                        {# Product badges #}
                        <div class="product-badges">
                            {% if not product.in_stock %}
                            <span class="badge badge-soldout">{{ t.sold_out }}</span>
                            {% endif %}
                            {% if product.is_pre_order %}
                            <span class="badge badge-preorder">{{ t.pre_order }}</span>
                            {% endif %}
                            {% if product.is_on_sale %}
                            <span class="badge badge-sale">{{ t.sale }}</span>
                            {% endif %}
                            {% if product.is_new_arrival %}
                            <span class="badge badge-new">{{ t.new }}</span>
                            {% endif %}
                        </div>
                    </div>

                    <h3>{{ product.zhtw_name if is_zhtw and product.zhtw_name else product.title }}</h3>

                    {% if is_zhtw %}
                        {% if product.final_price %}
                        <p class="price">NT${{ product.final_price|ntd }}</p>
                        {% endif %}
                    {% else %}
                        {% if product.is_on_sale and product.sale_price > 0 %}
                        <p class="price">
                            <span class="original-price">${{ "%.2f"|format(product.price) }}</span>
                            <span class="sale-price">${{ "%.2f"|format(product.sale_price) }}</span>
                        </p>
                        {% else %}
                        <p class="price">${{ "%.2f"|format(product.price) }}</p>
                        {% endif %}
                    {% endif %}
                </a>
            </div>
            {% endfor %}
            {% if not products %}
            <p>{{ t.no_products_yet }}</p>
            {% endif %}
        </div>
    </div>
</section>

{% if posts %}
<section class="recent-posts">
    <div class="container">
        <h2>{{ t.recent_blog }}</h2>
        <div class="posts-grid">
            {% for post in posts %}
            <article class="post-card">
                <h3><a href="{{ url_prefix }}/blog/{{ post.slug }}">{{ post.title }}</a></h3>
                <p class="post-meta">{{ post.date }} {% if post.author %}by {{ post.author }}{% endif %}</p>
                <p>{{ post.excerpt }}</p>
                <a href="{{ url_prefix }}/blog/{{ post.slug }}" class="read-more">{{ t.read_more }}</a>
            </article>
            {% endfor %}
        </div>
        <a href="{{ url_prefix }}/blog" class="btn btn-secondary">{{ t.view_all_posts }}</a>
    </div>
</section>
{% endif %}

<script>
// GA4: Track promotion banner click
document.addEventListener('DOMContentLoaded', function() {
    {% if active_promo %}
    var promoBanner = document.querySelector('.promo-banner-link');
    if (promoBanner) {
        promoBanner.addEventListener('click', function() {
            if (typeof gtag === 'function') {
                gtag('event', 'select_promotion', {
                    promotion_id: '{{ active_promo.slug }}',
                    promotion_name: '{{ active_promo.title|replace("'", "\\'") }}'
                });
            }
        });
    }
    {% endif %}

    // Track blog post clicks
    document.querySelectorAll('.post-card a').forEach(function(link) {
        link.addEventListener('click', function() {
            if (typeof gtag === 'function') {
                var title = this.closest('.post-card').querySelector('h3 a')?.textContent?.trim();
                gtag('event', 'select_content', {
                    content_type: 'blog_post',
                    item_id: title || 'unknown'
                });
            }
        });
    });
});
</script>
{% endblock %}
